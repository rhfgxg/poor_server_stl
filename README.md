# poor_server_stl
c++（无qt库）的服务端版本

本项目用来尝试使用c++标准库重构qt版本的服务端
原项目使用 QT库，在面试和实际工作中发现，很少会使用 QT库作为服务器框架
所以决定使用本项目重构原代码，实现并学习下面功能：
1. 分布式服务器，多线程
2. 服务器之间通信和调用：RPC
3. 客户端与服务器，服务器之间通信协议：protobuf
4. 使用分层架构，多模块设计：各模块独享一个 CMakeLists文件，可以独立编译启动，通过顶级 CMakeLists文件管理
5. 使用对象池管理项目中需要频繁创建删除的对象
6. 结合lua语言实现配置文件等的热更新

# 项目中使用的第三方库
所有第三方库文件都放在 vcpkg_installed/x64-windwos 文件夹下（需要使用vcpkg安装后，自动生成）

## 第三方库列表
仅包含直接使用的库列表

### boost：网络库

### mysql-connector-cpp：mysql库
使用mysqlx协议，所以链接数据库的端口是33060

### nlohmann-json：json操作库

### protobuf：客户端与服务器，服务器之间的通信协议
这个需要用到proto编译器，这个文件在 /vcpkg_installed/x64-windows/tools/protobuf/protoc.exe
生成 rpc服务文件时，需要用到 grpc_cpp_plugin.exe，这个文件需要先安装 grpc库，安装后保存在 /vcpkg_installed/x64-windows/tools/grpc/grpc_cpp_plugin.exe
我这里使用 which指令寻找grpc_cpp_plugin工具时，一直找不到，所以使用的是相对路径
_ grpc使用的通信协议中，string默认是 utf-8格式，与c++冲突，所以在编写 proto文件时，需要使用 bytes代替string

#### 安装protobuf编译器
这里使用的是 protobuf-3.21.12版本，最新版的在cmake文件夹中没有CMakeLists.txt文件，编译时会很麻烦
【有道云笔记】protobuf安装与使用 https://note.youdao.com/s/C7fckSY5

### grpc：客户端与服务器，服务器之间的通信协议
实现服务器之间的远程调用


# 各服务器模块功能
## 中心服务器
主要负责管理所有服务器，包括：服务器启停，活动，服务器之间的通信，监控等，还负责全服消息的发送
所有服务器的活动日志，其他服务器还会有自己的日志

## 网关服务器
处理客户端链接，断开
处理客户端的所有请求，然后转发给相应服务器进行处理，最后返回结果给客户端

## 逻辑服务器
负责处理所有游戏逻辑，包括：战斗，任务，商城等
用户管理：用户数据更新，用户数据存储，用户数据查询等

## 登录服务器
负责处理登录，注册等请求
服务器用户数量管理

## 数据库服务器
负责处理其他服务器对数据库的操作，还负责数据库的备份
### 处理数据库的增删改查
其他服务器通过指定数据库名，表名，字段名，条件等，向数据库服务器发送请求，数据库服务器处理后返回数据
其他服务器获取数据后，在自己的服务器中对数据进行逻辑处理

### 数据库的备份
定时备份数据库到另一个服务器

### 启动时保持数据库的完整性
可能由于配置文件更新，服务器异常等问题，导致数据库数据不完整，所以在启动时，需要检查数据库的完整性
数据缺失时，报出异常，停止服务器启动，等待管理员使用备份数据恢复数据库
自动创建缺失表
自动更新表字段

## 应用场景
服务器管理：
中心服务器启动，然后启动其他服务器，中心服务器负责监控其他服务器的状态，并写入日志

客户端登录：
客户端发出请求
网关服务器接收请求，然后向中心服务器索要登录服务器的信息
中心服务器，根据负载情况，返回登录服务器的信息给网关服务器
数据转发给登录服务器
登录服务器处理请求，根据数据内调用服务器的地址，直接返回结果给网关服务器
网关服务器返回结果给客户端