# 贡献指南

感谢你对 Poor Server STL 项目的关注！本文档将指导你完成贡献流程。

---

## 📋 新手快速开始

### 1. 首次设置（必须）

克隆项目后，**必须先运行以下命令**：

#### Windows
```powershell
cd poor_server_stl

# 统一所有文件的编码和换行符
.\tools\debug\windows\fix_encoding_and_lineendings.ps1

# 安装 Git 提交前检查（强烈推荐）
.\tools\debug\windows\install_git_hooks.ps1
```

#### Linux / WSL / macOS
```bash
cd poor_server_stl

# 统一所有文件的编码和换行符
bash tools/debug/linux/fix_encoding_and_lineendings.sh

# 安装 Git 提交前检查（强烈推荐）
bash tools/debug/linux/install_git_hooks.sh
```

**为什么需要这一步？**
- ✅ 确保所有文件使用 UTF-8 无 BOM 编码
- ✅ 确保所有文件使用 LF 换行符
- ✅ 防止提交不规范的代码
- ✅ 避免跨平台协作冲突

### 2. 配置编辑器

#### VS Code（推荐）
1. 安装 **EditorConfig for VS Code** 插件
2. 项目根目录的 `.editorconfig` 文件会自动配置编辑器

#### Visual Studio 2022
- 内置 EditorConfig 支持，无需额外配置
- `.editorconfig` 会自动生效

#### 其他编辑器
- 查看 [EditorConfig 官网](https://editorconfig.org/) 了解插件支持

---

## 🔧 开发流程

### 步骤 1: Fork 和克隆

1. 点击 GitHub 页面右上角的 **Fork** 按钮
2. 克隆你的 fork:
   ```bash
   git clone https://github.com/你的用户名/poor_server_stl.git
   cd poor_server_stl
   ```

### 步骤 2: 设置开发环境

参考 [快速开始指南](README.md#-快速开始) 安装依赖并编译项目。

### 步骤 3: 创建分支

```bash
git checkout -b feature/你的功能名称
# 或者
git checkout -b fix/你的修复名称
```

**分支命名规范**:
- `feature/*` - 新功能
- `fix/*` - Bug 修复
- `docs/*` - 文档更新
- `refactor/*` - 代码重构
- `perf/*` - 性能优化

### 步骤 4: 进行修改

- 编写清晰、可读的代码
- 遵循 [C++ 代码规范](docunment/layout/cpp_layout.md)
- 为复杂逻辑添加注释
- 必要时更新文档

### 步骤 5: 测试你的修改

```bash
# 编译项目
cmake -B build
cmake --build build

# 运行测试（如果有）
# TODO: 添加测试命令
```

### 步骤 6: 提交修改

使用 [约定式提交](https://www.conventionalcommits.org/zh-hans/) 格式:

```bash
git add .
git commit -m "feat(server): 为数据库添加连接池"
```

**提交信息格式**:
```
<类型>(<范围>): <主题>

<正文>

<页脚>
```

**类型**:
- `feat`: 新功能
- `fix`: Bug 修复
- `docs`: 文档更新
- `style`: 代码格式（不影响功能）
- `refactor`: 重构
- `perf`: 性能优化
- `test`: 测试相关
- `chore`: 构建/工具相关

**示例**:
```
feat(gateway): 实现客户端连接池

- 添加可配置大小的连接池
- 实现连接超时处理
- 添加连接池单元测试

Closes #123
```

### 步骤 7: 推送并创建 PR

```bash
git push origin feature/你的功能名称
```

然后在 GitHub 上创建 Pull Request。

---

## ✅ 提交前检查清单

提交前请确认：

- [ ] **代码可编译**，无错误和警告
- [ ] **所有文件使用 UTF-8 编码**（无 BOM）
- [ ] **所有文件使用 LF 换行符**（Windows 脚本除外）
- [ ] **代码遵循** [C++ 代码规范](docunment/layout/cpp_layout.md)
- [ ] **注释清晰**（代码注释用英文，文档用中文）
- [ ] **文档已更新**（如需要）
- [ ] **提交信息**遵循约定式提交格式

**提示**: 如果安装了 Git hook，不符合规范的代码会被自动拒绝！

---

## 📝 代码规范

### 文件编码

- **编码**: UTF-8 无 BOM
- **换行符**: LF（Linux 风格）
- **例外**: Windows 批处理文件（`.bat`, `.cmd`）使用 CRLF

**原因**:
- UTF-8 无 BOM 跨平台兼容性最好
- LF 是 Linux 服务器标准
- 防止跨平台协作时的编码冲突

### C++ 代码风格

详见 [C++ 代码规范](docunment/layout/cpp_layout.md)。

**要点**:
- 使用 4 个空格缩进（不使用 Tab）
- 变量和函数名使用 `snake_case`
- 类名使用 `PascalCase`
- 常量和宏使用 `UPPER_CASE`
- 为公共 API 和复杂逻辑添加注释

### 文档规范

- README 和文档使用**中文**（主要受众）
- 代码注释使用**英文**（国际标准）
- 保持文档与代码同步更新

---

## 🐛 报告问题

### 创建 Issue 前

1. **搜索已有 Issues** 避免重复
2. **查看文档** 寻找解决方案
3. **测试最新版本** 确认问题仍存在

### 创建有用的 Issue

应包含:
- **清晰的标题** 描述问题
- **复现步骤** 详细说明
- **预期行为** vs **实际行为**
- **环境信息**（操作系统、编译器版本等）
- **错误信息** 或日志（如有）
- **截图**（如适用）

**示例**:
```markdown
## Bug: 网关服务器在高并发下崩溃

### 环境
- 操作系统: Windows 11
- 编译器: MSVC 2022
- 构建类型: Release

### 复现步骤
1. 启动网关服务器
2. 运行压力测试，1000 个并发连接
3. 约 500 个连接后服务器崩溃

### 预期行为
服务器应能处理 1000+ 并发连接

### 实际行为
服务器崩溃，提示 "Access Violation" 错误

### 错误日志
[粘贴错误日志]
```

---

## 🎯 我们需要帮助的领域

欢迎在这些方面贡献：

### 高优先级
- 🐛 **Bug 修复** - 修复已报告的问题
- 📝 **文档** - 完善和翻译文档
- 🧪 **测试** - 添加单元测试和集成测试
- 🎨 **代码质量** - 重构和优化代码

### 中优先级
- ✨ **功能** - 实现计划中的功能
- 🔧 **工具** - 改进开发工具
- 🌍 **国际化** - 添加多语言支持
- 📊 **监控** - 添加日志和指标

### 低优先级
- 🎮 **游戏功能** - 实现游戏逻辑
- 🖼️ **UI/UX** - 客户端界面改进
- 📱 **平台支持** - macOS、移动平台

---

## 🤝 代码审查流程

### 审查要点

1. **功能性**
   - 是否按预期工作？
   - 是否处理边界情况？
   - 是否有 Bug？

2. **代码质量**
   - 代码是否清晰可读？
   - 是否遵循代码规范？
   - 注释是否充分？

3. **测试**
   - 新功能是否有测试？
   - 现有测试是否通过？

4. **文档**
   - 文档是否更新？
   - 注释是否清晰有用？

### 审查时间线

- **初次审查**: 2-3 天内
- **后续跟进**: 更新后 1-2 天
- **合并**: 维护者批准后

### 处理反馈

- **保持耐心** - 审查需要时间
- **保持开放** - 认真考虑建议
- **提问** - 如果反馈不清楚
- **迭代** - 根据反馈更新代码

---

## 📞 获取帮助

### 资源

- **文档中心**: [docunment/README.md](docunment/README.md)
- **快速指南**: [编码规范指南](docunment/layout/ENCODING_QUICKSTART.md)
- **代码规范**: [C++ 代码规范](docunment/layout/cpp_layout.md)

### 交流渠道

- **GitHub Issues** - Bug 报告和功能请求
- **Pull Requests** - 代码贡献和讨论
- **Discussions** - 一般性问题（如果启用）

---

## 📜 许可证

贡献代码即表示你同意你的贡献将使用 MIT 许可证。

---

## 🙏 感谢你！

每一个贡献，无论大小，都很重要。感谢你帮助改进 Poor Server STL！

**祝编码愉快！** 🚀
