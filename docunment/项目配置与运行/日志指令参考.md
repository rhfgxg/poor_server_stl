# æ—¥å¿—æŸ¥çœ‹æŒ‡å—

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•æŸ¥çœ‹å’Œåˆ†æé¡¹ç›®æ—¥å¿—ã€‚

---

## ğŸ“ æ—¥å¿—ç›®å½•ç»“æ„

```
logs/
â”œâ”€â”€ central.log          # Central ä¸­å¿ƒæœåŠ¡å™¨æ—¥å¿—
â”œâ”€â”€ db.log               # DB æ•°æ®åº“æœåŠ¡å™¨æ—¥å¿—
â”œâ”€â”€ gateway.log          # Gateway ç½‘å…³æœåŠ¡å™¨æ—¥å¿—
â”œâ”€â”€ login.log            # Login ç™»å½•æœåŠ¡å™¨æ—¥å¿—
â”œâ”€â”€ file.log             # File æ–‡ä»¶æœåŠ¡å™¨æ—¥å¿—
â”œâ”€â”€ matching.log         # Matching åŒ¹é…æœåŠ¡å™¨æ—¥å¿—
â”œâ”€â”€ skynet.log           # Skynet é€»è¾‘æœåŠ¡å™¨æ—¥å¿—
â””â”€â”€ redis_server.log     # Redis æœåŠ¡å™¨æ—¥å¿—
```

---

## ğŸ” å¸¸ç”¨æ—¥å¿—æŸ¥çœ‹å‘½ä»¤

### åŸºç¡€å‘½ä»¤

```bash
# æŸ¥çœ‹å®Œæ•´æ—¥å¿—
cat logs/gateway.log

# æŸ¥çœ‹æœ€å N è¡Œ
tail -n 50 logs/gateway.log

# æŸ¥çœ‹å¼€å¤´ N è¡Œ
head -n 50 logs/gateway.log

# å®æ—¶è¿½è¸ªæ—¥å¿—ï¼ˆæ¨èï¼‰
tail -f logs/gateway.log

# å®æ—¶è¿½è¸ªå¤šä¸ªæ—¥å¿—
tail -f logs/gateway.log logs/skynet.log
```

### æœç´¢è¿‡æ»¤

```bash
# æœç´¢å…³é”®è¯
grep "error" logs/gateway.log
grep -i "error" logs/gateway.log    # å¿½ç•¥å¤§å°å†™

# æœç´¢å¤šä¸ªå…³é”®è¯
grep -E "error|warn|fail" logs/gateway.log

# æ˜¾ç¤ºåŒ¹é…è¡Œçš„ä¸Šä¸‹æ–‡
grep -B 3 -A 3 "error" logs/gateway.log    # å‰åå„3è¡Œ

# æ’é™¤æŸäº›å†…å®¹
grep -v "heartbeat" logs/gateway.log

# ç»Ÿè®¡é”™è¯¯æ•°é‡
grep -c "error" logs/gateway.log
```

### æ—¶é—´è¿‡æ»¤

```bash
# æŸ¥çœ‹ä»Šå¤©çš„æ—¥å¿—ï¼ˆå‡è®¾æ—¥å¿—åŒ…å«æ—¥æœŸï¼‰
grep "$(date +%Y-%m-%d)" logs/gateway.log

# æŸ¥çœ‹æœ€è¿‘5åˆ†é’Ÿä¿®æ”¹çš„æ—¥å¿—
find logs/ -mmin -5 -name "*.log"

# æŸ¥çœ‹æŒ‡å®šæ—¶é—´æ®µ
awk '/2024-01-31 10:00/,/2024-01-31 11:00/' logs/gateway.log
```

### å®æ—¶ç›‘æ§ï¼ˆæ¨èï¼‰

```bash
# å®æ—¶è¿½è¸ªå¹¶é«˜äº®é”™è¯¯
tail -f logs/gateway.log | grep --color=auto -E "error|warn|$"

# å®æ—¶è¿½è¸ªæ‰€æœ‰æœåŠ¡å™¨æ—¥å¿—
tail -f logs/*.log

# å®æ—¶è¿½è¸ªå¹¶è¿‡æ»¤
tail -f logs/gateway.log | grep -i "skynet"
```

---

## ğŸ› ï¸ é«˜çº§å·¥å…·

### 1. less - äº¤äº’å¼æŸ¥çœ‹

```bash
# æ‰“å¼€æ—¥å¿—ï¼ˆæ”¯æŒä¸Šä¸‹æ»šåŠ¨ã€æœç´¢ï¼‰
less logs/gateway.log

# less å¸¸ç”¨å¿«æ·é”®:
# g     - è·³åˆ°å¼€å¤´
# G     - è·³åˆ°ç»“å°¾
# /text - å‘ä¸‹æœç´¢
# ?text - å‘ä¸Šæœç´¢
# n     - ä¸‹ä¸€ä¸ªåŒ¹é…
# N     - ä¸Šä¸€ä¸ªåŒ¹é…
# q     - é€€å‡º

# å®æ—¶è¿½è¸ªæ¨¡å¼
less +F logs/gateway.log
# æŒ‰ Ctrl+C æš‚åœï¼ŒæŒ‰ F ç»§ç»­è¿½è¸ª
```

### 2. multitail - å¤šæ—¥å¿—åŒæ—¶æŸ¥çœ‹

```bash
# å®‰è£…
sudo apt install multitail

# åŒæ—¶æŸ¥çœ‹å¤šä¸ªæ—¥å¿—ï¼ˆåˆ†å±æ˜¾ç¤ºï¼‰
multitail logs/gateway.log logs/skynet.log logs/central.log

# åˆå¹¶æ˜¾ç¤ºå¹¶ç€è‰²
multitail -ci green logs/gateway.log -ci yellow logs/skynet.log
```

### 3. lnav - æ—¥å¿—å¯¼èˆªå™¨ï¼ˆå¼ºçƒˆæ¨èï¼‰

```bash
# å®‰è£…
sudo apt install lnav

# æŸ¥çœ‹å•ä¸ªæ—¥å¿—
lnav logs/gateway.log

# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
lnav logs/

# lnav åŠŸèƒ½:
# - è‡ªåŠ¨è§£ææ—¥å¿—æ ¼å¼
# - è¯­æ³•é«˜äº®
# - æ—¶é—´çº¿å¯¼èˆª
# - SQL æŸ¥è¯¢
# - é”™è¯¯è‡ªåŠ¨é«˜äº®
```

### 4. ccze - æ—¥å¿—ç€è‰²

```bash
# å®‰è£…
sudo apt install ccze

# ç€è‰²æ˜¾ç¤º
cat logs/gateway.log | ccze -A

# å®æ—¶è¿½è¸ªå¹¶ç€è‰²
tail -f logs/gateway.log | ccze -A
```

---

## ğŸ“Š æ—¥å¿—åˆ†æå‘½ä»¤

### ç»Ÿè®¡åˆ†æ

```bash
# ç»Ÿè®¡å„çº§åˆ«æ—¥å¿—æ•°é‡
grep -c "\[info\]" logs/gateway.log
grep -c "\[warn\]" logs/gateway.log
grep -c "\[error\]" logs/gateway.log

# æŒ‰æ—¶é—´ç»Ÿè®¡è¯·æ±‚æ•°
grep "Request" logs/gateway.log | cut -d' ' -f1-2 | uniq -c

# æŸ¥çœ‹æœ€å¸¸è§çš„é”™è¯¯
grep -i "error" logs/gateway.log | sort | uniq -c | sort -rn | head -10
```

### æ€§èƒ½åˆ†æ

```bash
# æŸ¥çœ‹å“åº”æ—¶é—´ï¼ˆå‡è®¾æ—¥å¿—ä¸­æœ‰æ—¶é—´ä¿¡æ¯ï¼‰
grep "response_time" logs/gateway.log | awk '{print $NF}' | sort -n

# æŸ¥çœ‹æ…¢è¯·æ±‚
grep "response_time" logs/gateway.log | awk '$NF > 1000 {print}'
```

---

## ğŸ”§ é¡¹ç›®ä¸“ç”¨å‘½ä»¤

### å¿«é€ŸæŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
bash tools/service/manage.sh status

# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—æœ€åå‡ è¡Œ
for log in logs/*.log; do
    echo "=== $log ==="
    tail -n 5 "$log"
    echo ""
done
```

### ç›‘æ§ Skynet é€šä¿¡

```bash
# æŸ¥çœ‹ Skynet ç›¸å…³æ—¥å¿—
grep -i "skynet" logs/gateway.log

# æŸ¥çœ‹ Echo æµ‹è¯•
grep -i "echo" logs/gateway.log logs/skynet.log

# ç›‘æ§ TCP è¿æ¥
grep -E "connect|disconnect|connection" logs/gateway.log
```

### é”™è¯¯æ’æŸ¥

```bash
# æŸ¥çœ‹æ‰€æœ‰é”™è¯¯
grep -i "error\|fail\|exception" logs/*.log

# æŸ¥çœ‹æœ€è¿‘çš„é”™è¯¯
tail -n 100 logs/*.log | grep -i "error"

# æŸ¥çœ‹å¯åŠ¨å¤±è´¥åŸå› 
grep -A 5 "failed\|error" logs/central.log
```

---

## ğŸ“ æ—¥å¿—çº§åˆ«è¯´æ˜

| çº§åˆ« | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `TRACE` | æœ€è¯¦ç»†çš„è·Ÿè¸ªä¿¡æ¯ | è°ƒè¯•åº•å±‚æµç¨‹ |
| `DEBUG` | è°ƒè¯•ä¿¡æ¯ | å¼€å‘è°ƒè¯• |
| `INFO` | æ­£å¸¸è¿è¡Œä¿¡æ¯ | å¸¸è§„æ“ä½œè®°å½• |
| `WARN` | è­¦å‘Šä¿¡æ¯ | æ½œåœ¨é—®é¢˜ |
| `ERROR` | é”™è¯¯ä¿¡æ¯ | éœ€è¦å…³æ³¨çš„é”™è¯¯ |
| `CRITICAL` | ä¸¥é‡é”™è¯¯ | ç³»ç»Ÿçº§æ•…éšœ |

---

## ğŸ“‚ æ—¥å¿—åˆ†ç±»è¯´æ˜

é¡¹ç›®ä½¿ç”¨åˆ†ç±»æ—¥å¿—ç³»ç»Ÿï¼ˆè§ `src/common/consts/const_log.h`ï¼‰ï¼š

| åˆ†ç±» | è¯´æ˜ |
|------|------|
| `STARTUP_SHUTDOWN` | æœåŠ¡å¯åŠ¨å’Œå…³é—­ |
| `APPLICATION_ACTIVITY` | åº”ç”¨ç¨‹åºæ´»åŠ¨ï¼ˆè¯·æ±‚ã€å“åº”ï¼‰ |
| `CONNECTION_POOL` | è¿æ¥æ± æ“ä½œ |
| `SYSTEM_MONITORING` | ç³»ç»Ÿç›‘æ§ã€æ€§èƒ½ |
| `HEARTBEAT` | å¿ƒè·³æ£€æµ‹ |
| `SECURITY` | å®‰å…¨ç›¸å…³ |
| `CONFIGURATION_CHANGES` | é…ç½®å˜æ›´ |
| `DATABASE_OPERATIONS` | æ•°æ®åº“æ“ä½œ |
| `USER_ACTIVITY` | ç”¨æˆ·æ´»åŠ¨ |
| `NETWORK` | ç½‘ç»œç›¸å…³ |

---

## ğŸš€ ä¸€é”®è„šæœ¬

å°†ä»¥ä¸‹å†…å®¹ä¿å­˜ä¸º `tools/logs.sh`ï¼š

```bash
#!/bin/bash
# æ—¥å¿—æŸ¥çœ‹å·¥å…·

LOGS_DIR="logs"

case "${1:-help}" in
    all)
        # æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—æœ€åNè¡Œ
        N="${2:-20}"
        for log in $LOGS_DIR/*.log; do
            echo -e "\n\033[1;34m=== $(basename $log) ===\033[0m"
            tail -n $N "$log"
        done
        ;;
    
    follow|f)
        # å®æ—¶è¿½è¸ªæŒ‡å®šæœåŠ¡å™¨æ—¥å¿—
        SERVER="${2:-gateway}"
        tail -f "$LOGS_DIR/${SERVER}.log"
        ;;
    
    follow-all|fa)
        # å®æ—¶è¿½è¸ªæ‰€æœ‰æ—¥å¿—
        tail -f $LOGS_DIR/*.log
        ;;
    
    errors|e)
        # æŸ¥çœ‹æ‰€æœ‰é”™è¯¯
        grep -i "error\|fail\|exception" $LOGS_DIR/*.log | tail -n "${2:-50}"
        ;;
    
    search|s)
        # æœç´¢å…³é”®è¯
        grep -i "$2" $LOGS_DIR/*.log
        ;;
    
    clear)
        # æ¸…ç©ºæ‰€æœ‰æ—¥å¿—
        for log in $LOGS_DIR/*.log; do
            > "$log"
        done
        echo "æ‰€æœ‰æ—¥å¿—å·²æ¸…ç©º"
        ;;
    
    *)
        echo "æ—¥å¿—æŸ¥çœ‹å·¥å…·"
        echo ""
        echo "ç”¨æ³•: bash $0 <å‘½ä»¤> [å‚æ•°]"
        echo ""
        echo "å‘½ä»¤:"
        echo "  all [N]        - æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—æœ€å N è¡Œï¼ˆé»˜è®¤20ï¼‰"
        echo "  follow <æœåŠ¡>  - å®æ—¶è¿½è¸ªæŒ‡å®šæœåŠ¡å™¨æ—¥å¿—"
        echo "  follow-all     - å®æ—¶è¿½è¸ªæ‰€æœ‰æ—¥å¿—"
        echo "  errors [N]     - æŸ¥çœ‹æœ€å N æ¡é”™è¯¯ï¼ˆé»˜è®¤50ï¼‰"
        echo "  search <å…³é”®è¯> - æœç´¢æ‰€æœ‰æ—¥å¿—"
        echo "  clear          - æ¸…ç©ºæ‰€æœ‰æ—¥å¿—"
        echo ""
        echo "ç¤ºä¾‹:"
        echo "  bash $0 all 50           # æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—æœ€å50è¡Œ"
        echo "  bash $0 follow gateway   # å®æ—¶è¿½è¸ª gateway æ—¥å¿—"
        echo "  bash $0 follow skynet    # å®æ—¶è¿½è¸ª skynet æ—¥å¿—"
        echo "  bash $0 errors           # æŸ¥çœ‹æ‰€æœ‰é”™è¯¯"
        echo "  bash $0 search echo      # æœç´¢ echo ç›¸å…³æ—¥å¿—"
        ;;
esac
```

ä½¿ç”¨æ–¹æ³•ï¼š

```bash
bash tools/logs.sh all           # æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
bash tools/logs.sh follow gateway # å®æ—¶è¿½è¸ª gateway
bash tools/logs.sh errors        # æŸ¥çœ‹é”™è¯¯
bash tools/logs.sh search skynet # æœç´¢ skynet
```

---

## ğŸ’¡ å¸¸è§é—®é¢˜æ’æŸ¥

### 1. æœåŠ¡å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
head -n 50 logs/gateway.log

# æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
grep -i "error\|fail" logs/gateway.log | head -n 20
```

### 2. Skynet é€šä¿¡é—®é¢˜

```bash
# æŸ¥çœ‹è¿æ¥æ—¥å¿—
grep -i "connect" logs/gateway.log logs/skynet.log

# æŸ¥çœ‹ TCP æ¶ˆæ¯
grep -i "tcp\|socket" logs/gateway.log
```

### 3. æ•°æ®åº“é—®é¢˜

```bash
# æŸ¥çœ‹ DB æœåŠ¡å™¨æ—¥å¿—
tail -n 100 logs/db.log

# æŸ¥çœ‹æ•°æ®åº“æ“ä½œ
grep -i "database\|mysql\|query" logs/db.log
```

### 4. Redis é—®é¢˜

```bash
# æ£€æŸ¥ Redis è¿æ¥
redis-cli ping

# æŸ¥çœ‹ Redis æ—¥å¿—
tail -n 50 logs/redis_server.log
```
