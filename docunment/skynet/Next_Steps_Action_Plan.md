# ä¸‹ä¸€æ­¥è¡ŒåŠ¨è®¡åˆ’

> **å½“å‰çŠ¶æ€**: Skynet é›†æˆå·²å®Œæˆï¼Œè¿æ¥æµ‹è¯•é€šè¿‡  
> **ç›®æ ‡**: å®ç°å®Œæ•´çš„ç©å®¶ç®¡ç†å’Œæ•°æ®æŒä¹…åŒ–ç³»ç»Ÿ  
> **é¢„è®¡æ—¶é—´**: 1-2 å‘¨

---

## ğŸ“‹ ä»»åŠ¡ä¼˜å…ˆçº§

### ğŸ”¥ P0 - ç«‹å³å¼€å§‹ï¼ˆæœ¬å‘¨ï¼‰

#### 1. å®Œå–„ç©å®¶æ•°æ®æŒä¹…åŒ– (2-3å¤©)

**ç°çŠ¶**: 
- âœ… PlayerManager å’Œ PlayerAgent åŸºç¡€ç»“æ„å·²å®Œæˆ
- âŒ æ•°æ®åªåœ¨å†…å­˜ä¸­ï¼ŒæœªæŒä¹…åŒ–
- âŒ æ²¡æœ‰ Redis ç¼“å­˜å±‚
- âŒ æ²¡æœ‰ MySQL å­˜å‚¨

**ç›®æ ‡**: å®ç°ä¸‰çº§æ•°æ®å­˜å‚¨æ¶æ„

**ä»»åŠ¡æ¸…å•**:
```
â–¡ Task 1.1: å®ç° Redis ç¼“å­˜å±‚ (1å¤©)
  - åˆ›å»º redis_bridge.lua (Lua â†’ RedisServer çš„æ¡¥æ¥)
  - å®ç°ç©å®¶æ•°æ® Redis ç¼“å­˜è¯»å†™
  - è®¾è®¡ Key å‘½åè§„èŒƒ
    * player:{player_id}:basic
    * player:{player_id}:cards
    * player:{player_id}:achievements
  - å®ç°ç¼“å­˜è¿‡æœŸç­–ç•¥ï¼ˆTTL: 30åˆ†é’Ÿï¼‰

â–¡ Task 1.2: å®ç° MySQL æŒä¹…åŒ–å±‚ (1å¤©)
  - åˆ›å»º db_bridge.lua (Lua â†’ DBServer çš„æ¡¥æ¥)
  - è®¾è®¡æ•°æ®åº“è¡¨ç»“æ„
    * poor_users.players (åŸºç¡€ä¿¡æ¯)
    * poor_hearthstone.player_cards (å¡ç‰Œ)
    * poor_hearthstone.player_achievements (æˆå°±)
  - å®ç°æ•°æ®åŠ è½½/ä¿å­˜æ¥å£
  - å®ç°æ‰¹é‡å†™å…¥ä¼˜åŒ–

â–¡ Task 1.3: å®ç°æ•°æ®åŒæ­¥ç­–ç•¥ (0.5å¤©)
  - ç©å®¶ä¸Šçº¿ï¼šMySQL â†’ Redis â†’ Lua å†…å­˜
  - ç©å®¶åœ¨çº¿ï¼šå®šæ—¶åŒæ­¥åˆ° Redisï¼ˆæ¯ 5 åˆ†é’Ÿï¼‰
  - ç©å®¶ä¸‹çº¿ï¼šç«‹å³ä¿å­˜åˆ° MySQL
  - å®šæ—¶æ‰¹é‡æŒä¹…åŒ–ï¼ˆæ¯ 30 åˆ†é’Ÿï¼‰
  - å®ç°äº‹åŠ¡ä¸€è‡´æ€§ä¿æŠ¤
```

**äº¤ä»˜ç‰©**:
```
æ–°å¢æ–‡ä»¶ï¼š
- skynet_src/lualib/redis_bridge.lua
- skynet_src/lualib/db_bridge.lua
- skynet_src/lualib/data_sync.lua

ä¿®æ”¹æ–‡ä»¶ï¼š
- skynet_src/service/logic/player_agent.lua (é›†æˆæ•°æ®æŒä¹…åŒ–)
- skynet_src/service/player_manager.lua (æ•°æ®åŠ è½½/ä¿å­˜é€»è¾‘)

æ–‡æ¡£ï¼š
- docunment/skynet/Data_Persistence.md (æ•°æ®æŒä¹…åŒ–è®¾è®¡æ–‡æ¡£)
```

---

#### 2. å®ç°æˆå°±ç³»ç»Ÿå®Œæ•´åŠŸèƒ½ (1-2å¤©)

**ç°çŠ¶**:
- âœ… AchievementService åŸºç¡€ç»“æ„å­˜åœ¨
- âŒ æˆå°±å®šä¹‰ä¸å®Œæ•´
- âŒ è§¦å‘é€»è¾‘ç®€å•
- âŒ å¥–åŠ±å‘æ”¾æœªå®ç°

**ä»»åŠ¡æ¸…å•**:
```
â–¡ Task 2.1: å®Œå–„æˆå°±é…ç½® (0.5å¤©)
  - è®¾è®¡æˆå°±é…ç½®è¡¨ç»“æ„
  - å®šä¹‰å¸¸è§æˆå°±ç±»å‹
    * ç´¯è®¡å‹ï¼šå®Œæˆ N åœºå¯¹æˆ˜
    * æ¡ä»¶å‹ï¼šè¾¾åˆ° X ç­‰çº§
    * ç»„åˆå‹ï¼šåŒæ—¶æ»¡è¶³å¤šä¸ªæ¡ä»¶
  - é…ç½®æˆå°±å¥–åŠ±ï¼ˆé‡‘å¸ã€å¡ç‰Œç­‰ï¼‰

â–¡ Task 2.2: å®ç°è§¦å‘å’Œæ£€æµ‹ (0.5å¤©)
  - ä¼˜åŒ– update_progress é€»è¾‘
  - å®ç°å¤æ‚æ¡ä»¶åˆ¤æ–­
  - æ”¯æŒå¤šäº‹ä»¶å…³è”
  - å®ç°æˆå°±é“¾ï¼ˆè§£é”åç»­æˆå°±ï¼‰

â–¡ Task 2.3: å®ç°å¥–åŠ±å‘æ”¾ (0.5å¤©)
  - å‘æ”¾é‡‘å¸å¥–åŠ±
  - å‘æ”¾å¡ç‰Œå¥–åŠ±
  - è®°å½•å¥–åŠ±å†å²
  - æ¨é€æˆå°±è§£é”é€šçŸ¥åˆ°å®¢æˆ·ç«¯
```

**äº¤ä»˜ç‰©**:
```
æ–°å¢æ–‡ä»¶ï¼š
- config/skynet/achievement_config.lua (æˆå°±é…ç½®)
- skynet_src/lualib/reward_system.lua (å¥–åŠ±ç³»ç»Ÿ)

ä¿®æ”¹æ–‡ä»¶ï¼š
- skynet_src/service/logic/achievement_service.lua
- skynet_src/service/logic/player_agent.lua

æµ‹è¯•ï¼š
- æˆå°±è§£é”åŠŸèƒ½æµ‹è¯•
- å¥–åŠ±å‘æ”¾æ­£ç¡®æ€§éªŒè¯
```

---

### ğŸŸ¡ P1 - æœ¬å‘¨å®Œæˆï¼ˆå¦‚æœ‰æ—¶é—´ï¼‰

#### 3. å®ç°åŸºç¡€æ¸¸æˆåŠŸèƒ½ (2-3å¤©)

**ä»»åŠ¡æ¸…å•**:
```
â–¡ Task 3.1: ç©å®¶ç­‰çº§ç³»ç»Ÿ (1å¤©)
  - å®ç°ç»éªŒå€¼è®¡ç®—
  - ç­‰çº§æå‡é€»è¾‘
  - ç­‰çº§å¥–åŠ±é…ç½®
  - å‡çº§æ¨é€é€šçŸ¥

â–¡ Task 3.2: é‡‘å¸ç³»ç»Ÿ (0.5å¤©)
  - é‡‘å¸å¢å‡æ¥å£
  - äº¤æ˜“è®°å½•æ—¥å¿—
  - é˜²åˆ·é‡‘å¸æ£€æµ‹

â–¡ Task 3.3: å¡ç‰Œæ”¶é›†ç³»ç»Ÿ (1å¤©)
  - å¡ç‰Œè·å–æ¥å£
  - å¡ç‰Œå‡çº§ç³»ç»Ÿ
  - å¡ç‰Œåˆ†è§£/åˆæˆ
  - å¡ç»„ç®¡ç†
```

---

### ğŸŸ¢ P2 - ä¸‹å‘¨å¼€å§‹

#### 4. å®ç°ç‚‰çŸ³ä¼ è¯´æ ¸å¿ƒç©æ³• (1å‘¨)

**ä»»åŠ¡æ¸…å•**:
```
â–¡ Task 4.1: åŒ¹é…ç³»ç»Ÿ (2å¤©)
  - ç©å®¶åŒ¹é…é˜Ÿåˆ—
  - ELO åŒ¹é…ç®—æ³•
  - åŒ¹é…è¶…æ—¶å¤„ç†

â–¡ Task 4.2: å¯¹æˆ˜ç³»ç»Ÿ (3å¤©)
  - æˆ˜æ–—é€»è¾‘æ¡†æ¶
  - å›åˆåˆ¶ç®¡ç†
  - æŠ€èƒ½/æ•ˆæœç³»ç»Ÿ
  - æˆ˜æ–—ç»“ç®—

â–¡ Task 4.3: æ’è¡Œæ¦œç³»ç»Ÿ (1å¤©)
  - Redis æ’è¡Œæ¦œ
  - å®æ—¶æ›´æ–°
  - èµ›å­£é‡ç½®
```

---

## ğŸ› ï¸ å®æ–½æŒ‡å—

### Week 1: æ•°æ®æŒä¹…åŒ– + æˆå°±ç³»ç»Ÿ

**Monday - Tuesday**:
```bash
# Day 1: Redis ç¼“å­˜å±‚
1. åˆ›å»º redis_bridge.lua
2. å®ç° Redis è¿æ¥ç®¡ç†
3. å®ç°åŸºæœ¬çš„ GET/SET/HGET/HSET æ“ä½œ
4. æµ‹è¯• Redis è¯»å†™æ€§èƒ½

# Day 2: MySQL æŒä¹…åŒ–å±‚
1. åˆ›å»º db_bridge.lua
2. è®¾è®¡æ•°æ®åº“è¡¨ç»“æ„ï¼ˆå»ºè¡¨ SQLï¼‰
3. å®ç° CRUD æ¥å£
4. æµ‹è¯•æ•°æ®å®Œæ•´æ€§
```

**Wednesday - Thursday**:
```bash
# Day 3: æ•°æ®åŒæ­¥ç­–ç•¥
1. å®ç°ç©å®¶æ•°æ®åŠ è½½æµç¨‹
2. å®ç°å®šæ—¶åŒæ­¥é€»è¾‘
3. å®ç°ç©å®¶ä¸‹çº¿ä¿å­˜
4. å‹åŠ›æµ‹è¯•æ•°æ®ä¸€è‡´æ€§

# Day 4: æˆå°±ç³»ç»Ÿ
1. å®Œå–„æˆå°±é…ç½®
2. ä¼˜åŒ–è§¦å‘é€»è¾‘
3. å®ç°å¥–åŠ±å‘æ”¾
4. ç«¯åˆ°ç«¯æµ‹è¯•
```

**Friday**:
```bash
# Day 5: é›†æˆæµ‹è¯•å’Œæ–‡æ¡£
1. å®Œæ•´æµç¨‹æµ‹è¯•
   - ç©å®¶æ³¨å†Œ â†’ è¿›å…¥æ¸¸æˆ â†’ æ“ä½œ â†’ ç¦»çº¿ â†’ å†æ¬¡ç™»å½•
2. éªŒè¯æ•°æ®æŒä¹…åŒ–
3. æ›´æ–°æ–‡æ¡£
4. Code Review
```

---

### Week 2: æ¸¸æˆåŠŸèƒ½ + ä¼˜åŒ–

**Monday - Wednesday**:
```bash
# Day 6-8: åŸºç¡€æ¸¸æˆåŠŸèƒ½
1. å®ç°ç­‰çº§ç³»ç»Ÿ
2. å®ç°é‡‘å¸ç³»ç»Ÿ
3. å®ç°å¡ç‰Œç³»ç»Ÿ
4. åŠŸèƒ½æµ‹è¯•
```

**Thursday - Friday**:
```bash
# Day 9-10: æ€§èƒ½ä¼˜åŒ–å’Œå‡†å¤‡
1. æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–
2. å‡†å¤‡ç‚‰çŸ³ä¼ è¯´ç©æ³•å¼€å‘
3. è®¾è®¡æ–‡æ¡£ç¼–å†™
```

---

## ğŸ“ ä»£ç æ¨¡æ¿

### redis_bridge.lua åŸºç¡€ç»“æ„

```lua
-- Redis æ¡¥æ¥æœåŠ¡ï¼ˆç¤ºä¾‹ï¼‰
local skynet = require "skynet"

local M = {}

local redis_stub = nil

-- åˆå§‹åŒ– Redis è¿æ¥
function M.init()
    -- é€šè¿‡ ConnectionPool è·å– RedisServer è¿æ¥
    -- TODO: å®ç°è¿æ¥è·å–é€»è¾‘
end

-- è·å–ç©å®¶åŸºç¡€æ•°æ®
function M.get_player_basic(player_id)
    local key = "player:" .. player_id .. ":basic"
    -- TODO: è°ƒç”¨ RedisServer gRPC æ¥å£
end

-- ä¿å­˜ç©å®¶åŸºç¡€æ•°æ®
function M.set_player_basic(player_id, data)
    local key = "player:" .. player_id .. ":basic"
    -- TODO: åºåˆ—åŒ– data å¹¶ä¿å­˜åˆ° Redis
end

return M
```

### db_bridge.lua åŸºç¡€ç»“æ„

```lua
-- æ•°æ®åº“æ¡¥æ¥æœåŠ¡ï¼ˆç¤ºä¾‹ï¼‰
local skynet = require "skynet"

local M = {}

-- åŠ è½½ç©å®¶æ•°æ®
function M.load_player(player_id)
    -- TODO: è°ƒç”¨ DBServer gRPC æ¥å£æŸ¥è¯¢æ•°æ®åº“
    -- æŸ¥è¯¢å¤šä¸ªè¡¨å¹¶ç»„è£…å®Œæ•´æ•°æ®
end

-- ä¿å­˜ç©å®¶æ•°æ®
function M.save_player(player_id, data)
    -- TODO: æ‹†åˆ†æ•°æ®åˆ°ä¸åŒçš„è¡¨
    -- è°ƒç”¨ DBServer æ‰¹é‡æ›´æ–°
end

return M
```

---

## âœ… éªŒæ”¶æ ‡å‡†

### æ•°æ®æŒä¹…åŒ–ç³»ç»Ÿ

**åŠŸèƒ½éªŒæ”¶**:
- [ ] ç©å®¶ç™»å½•æ—¶èƒ½ä» MySQL åŠ è½½å†å²æ•°æ®
- [ ] ç©å®¶æ“ä½œå®æ—¶æ›´æ–°åˆ°å†…å­˜
- [ ] æ¯ 5 åˆ†é’Ÿè‡ªåŠ¨åŒæ­¥åˆ° Redis
- [ ] æ¯ 30 åˆ†é’Ÿè‡ªåŠ¨æŒä¹…åŒ–åˆ° MySQL
- [ ] ç©å®¶ä¸‹çº¿æ—¶ç«‹å³ä¿å­˜æ‰€æœ‰æ•°æ®
- [ ] å¼‚å¸¸æ–­çº¿åæ•°æ®ä¸ä¸¢å¤±ï¼ˆæœ€å¤šä¸¢å¤± 5 åˆ†é’Ÿï¼‰

**æ€§èƒ½éªŒæ”¶**:
- [ ] å•æ¬¡æ•°æ®åŠ è½½ < 100ms
- [ ] å•æ¬¡ Redis åŒæ­¥ < 50ms
- [ ] MySQL æ‰¹é‡å†™å…¥æ”¯æŒ 100+ ç©å®¶/ç§’
- [ ] å†…å­˜å ç”¨åˆç†ï¼ˆæ¯ä¸ªç©å®¶ < 1MBï¼‰

### æˆå°±ç³»ç»Ÿ

**åŠŸèƒ½éªŒæ”¶**:
- [ ] æˆå°±è§¦å‘æ­£ç¡®ï¼ˆ100% å‡†ç¡®ç‡ï¼‰
- [ ] å¥–åŠ±å‘æ”¾æ­£ç¡®
- [ ] æˆå°±è§£é”æ¨é€åˆ°å®¢æˆ·ç«¯
- [ ] æˆå°±è¿›åº¦æ­£ç¡®æ˜¾ç¤º
- [ ] æ”¯æŒè‡³å°‘ 50 ç§æˆå°±ç±»å‹

---

## ğŸ¯ æœ¬å‘¨ç›®æ ‡

**æ ¸å¿ƒç›®æ ‡**: å®Œæˆç©å®¶æ•°æ®æŒä¹…åŒ–ç³»ç»Ÿ

**å…³é”®æŒ‡æ ‡**:
- âœ… æ•°æ®åŠ è½½æˆåŠŸç‡ > 99.9%
- âœ… æ•°æ®ä¿å­˜æˆåŠŸç‡ > 99.9%
- âœ… æ•°æ®åŒæ­¥å»¶è¿Ÿ < 1ç§’
- âœ… æ”¯æŒ 1000+ å¹¶å‘ç©å®¶

**äº¤ä»˜ç‰©**:
1. âœ… redis_bridge.lua (å®Œæ•´å®ç°)
2. âœ… db_bridge.lua (å®Œæ•´å®ç°)
3. âœ… æ•°æ®æŒä¹…åŒ–è®¾è®¡æ–‡æ¡£
4. âœ… é›†æˆæµ‹è¯•æŠ¥å‘Š
5. âœ… æ€§èƒ½æµ‹è¯•æŠ¥å‘Š

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœåœ¨å®æ–½è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥éšæ—¶å¯»æ±‚å¸®åŠ©ï¼š

1. **Redis è¿æ¥é—®é¢˜**: å‚è€ƒ `src/common/redis_client.h`
2. **æ•°æ®åº“è¿æ¥é—®é¢˜**: å‚è€ƒ `src/db/server/db_server.cpp`
3. **Protobuf ç¼–è§£ç **: å‚è€ƒ `skynet_src/lualib/proto_util.lua`
4. **Skynet é€šä¿¡**: å‚è€ƒ `skynet_src/service/cpp_gateway.lua`

---

**ä¸‹ä¸€æ­¥ç«‹å³å¼€å§‹**: åˆ›å»º `redis_bridge.lua` å’Œ `db_bridge.lua`

**é¢„è®¡å®Œæˆæ—¶é—´**: æœ¬å‘¨äº”ï¼ˆ5ä¸ªå·¥ä½œæ—¥ï¼‰

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¶é—´**: 2025å¹´12æœˆ  
**è´Ÿè´£äºº**: å¼€å‘å›¢é˜Ÿ
