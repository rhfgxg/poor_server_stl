// Skynet 匹配服务协议
// 处理玩家匹配、队列管理等

syntax = "proto3";
package skynet_proto;

import "skynet_common.proto";

// ==================== 匹配模式 ====================

enum MatchMode {
    MATCH_MODE_UNKNOWN = 0;
    MATCH_MODE_CASUAL = 1;      // 休闲模式
    MATCH_MODE_RANKED = 2;      // 天梯模式
    MATCH_MODE_ARENA = 3;       // 竞技场
    MATCH_MODE_TAVERN_BRAWL = 4; // 乱斗模式
    MATCH_MODE_FRIENDLY = 5;    // 好友对战
}

// ==================== 匹配请求/响应 (300-349) ====================

// 开始匹配请求 (type = 300)
message StartMatchRequest {
    string player_id = 1;
    MatchMode mode = 2;
    string deck_id = 3;
}

// 开始匹配响应 (type = 400)
message StartMatchResponse {
    bool success = 1;
    string message = 2;
    string queue_id = 3;
    int32 estimated_wait_seconds = 4;
}

// 取消匹配请求 (type = 301)
message CancelMatchRequest {
    string player_id = 1;
    string queue_id = 2;
}

// 取消匹配响应 (type = 401)
message CancelMatchResponse {
    bool success = 1;
    string message = 2;
}

// 获取匹配状态请求 (type = 302)
message GetMatchStatusRequest {
    string player_id = 1;
    string queue_id = 2;
}

// 获取匹配状态响应 (type = 402)
message GetMatchStatusResponse {
    bool success = 1;
    MatchStatus status = 2;
    int32 wait_seconds = 3;
    int32 queue_position = 4;
}

// 匹配状态
enum MatchStatus {
    MATCH_STATUS_UNKNOWN = 0;
    MATCH_STATUS_QUEUING = 1;    // 排队中
    MATCH_STATUS_FOUND = 2;      // 已找到对手
    MATCH_STATUS_READY = 3;      // 准备就绪
    MATCH_STATUS_CANCELLED = 4;  // 已取消
    MATCH_STATUS_TIMEOUT = 5;    // 超时
}

// ==================== 匹配推送 (450-499) ====================

// 推送匹配结果 (type = 450)
message PushMatchFound {
    string player_id = 1;
    string battle_id = 2;
    string opponent_id = 3;
    string opponent_name = 4;
    int32 opponent_rank = 5;
    bool is_first = 6;           // 是否先手
}

// 推送匹配进度 (type = 451)
message PushMatchProgress {
    string player_id = 1;
    string queue_id = 2;
    int32 wait_seconds = 3;
    int32 queue_position = 4;
}

// 推送匹配取消 (type = 452)
message PushMatchCancelled {
    string player_id = 1;
    string reason = 2;
}
