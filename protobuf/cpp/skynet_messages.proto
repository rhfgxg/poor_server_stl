// Skynet 消息协议定义
// 用于 C++ Gateway 和 Skynet Logic Server 之间的通信

syntax = "proto3";
package skynet_proto;

// ==================== 消息类型枚举 ====================
enum MessageType {
    MSG_UNKNOWN = 0;
    
    // 玩家会话管理 (1-99)
    MSG_ENTER_GAME = 1;           // 进入游戏
    MSG_LEAVE_GAME = 2;           // 离开游戏
    MSG_PLAYER_ACTION = 3;        // 玩家操作
    MSG_GET_PLAYER_STATUS = 4;    // 获取玩家状态
    
    // 响应消息 (101-199)
    MSG_ENTER_GAME_RES = 101;
    MSG_LEAVE_GAME_RES = 102;
    MSG_PLAYER_ACTION_RES = 103;
    MSG_GET_PLAYER_STATUS_RES = 104;
    
    // 推送消息 (200-299)
    MSG_PUSH_GAME_STATE = 200;    // 推送游戏状态
    MSG_PUSH_NOTIFICATION = 201;  // 推送通知
    MSG_PUSH_ACHIEVEMENT = 202;   // 推送成就解锁
    
    // 炉石传说相关 (300-399)
    MSG_HEARTHSTONE_MATCH = 300;      // 匹配请求
    MSG_HEARTHSTONE_BATTLE = 301;     // 战斗操作
    MSG_HEARTHSTONE_DECK = 302;       // 卡组操作
    MSG_HEARTHSTONE_COLLECTION = 303; // 收藏操作
}

// ==================== 基础消息结构 ====================

// 进入游戏请求
message EnterGameRequest {
    string player_id = 1;
    string token = 2;
    string client_version = 3;
}

// 进入游戏响应
message EnterGameResponse {
    bool success = 1;
    string message = 2;
    PlayerData player_data = 3;
}

// 离开游戏请求
message LeaveGameRequest {
    string player_id = 1;
    string reason = 2;  // 离开原因：logout, disconnect, timeout
}

// 离开游戏响应
message LeaveGameResponse {
    bool success = 1;
    string message = 2;
}

// 玩家操作请求
message PlayerActionRequest {
    string player_id = 1;
    string action_type = 2;  // 操作类型：complete_match, buy_item, etc.
    bytes action_data = 3;   // 操作数据（JSON 或其他格式）
}

// 玩家操作响应
message PlayerActionResponse {
    bool success = 1;
    string message = 2;
    bytes result_data = 3;
    repeated Achievement unlocked_achievements = 4;  // 解锁的成就
}

// 获取玩家状态请求
message GetPlayerStatusRequest {
    string player_id = 1;
}

// 获取玩家状态响应
message GetPlayerStatusResponse {
    bool success = 1;
    PlayerData player_data = 2;
}

// ==================== 数据结构 ====================

// 玩家数据
message PlayerData {
    string player_id = 1;
    int32 level = 2;
    int32 exp = 3;
    int32 gold = 4;
    repeated string owned_cards = 5;  // 拥有的卡牌ID列表
    AchievementData achievements = 6;
    int64 last_login = 7;  // 最后登录时间（时间戳）
}

// 成就数据
message AchievementData {
    map<string, int32> progress = 1;      // achievement_id -> progress
    map<string, bool> completed = 2;      // achievement_id -> is_completed
}

// 成就信息
message Achievement {
    string id = 1;
    string name = 2;
    string description = 3;
    int32 reward_gold = 4;
}

// ==================== 推送消息 ====================

// 推送游戏状态
message PushGameState {
    string player_id = 1;
    string state_type = 2;  // battle, lobby, matching
    bytes state_data = 3;
}

// 推送通知
message PushNotification {
    string player_id = 1;
    string notification_type = 2;  // info, warning, error
    string title = 3;
    string content = 4;
}

// 推送成就解锁
message PushAchievement {
    string player_id = 1;
    Achievement achievement = 2;
}

// ==================== 炉石传说相关消息 ====================

// 匹配请求
message HearthstoneMatchRequest {
    string player_id = 1;
    string deck_id = 2;
}

// 匹配响应
message HearthstoneMatchResponse {
    bool success = 1;
    string message = 2;
    string match_id = 3;
}

// 战斗操作请求
message HearthstoneBattleRequest {
    string player_id = 1;
    string battle_id = 2;
    string action = 3;  // play_card, attack, end_turn
    bytes action_params = 4;
}

// 战斗操作响应
message HearthstoneBattleResponse {
    bool success = 1;
    string message = 2;
    bytes battle_state = 3;
}
